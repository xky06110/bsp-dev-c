global_settings:
  monitor_sleep_ms: 1000
modules:
- id: blink_led
  name: BlinkLED
  constructor_args:
    blink_cycle: 250
- id: bmi088
  name: BMI088
  constructor_args:
    gyro_freq: BMI088::GyroFreq::GYRO_1000HZ_BW116HZ
    accl_freq: BMI088::AcclFreq::ACCL_800HZ
    gyro_range: BMI088::GyroRange::DEG_2000DPS
    accl_range: BMI088::AcclRange::ACCL_24G
    rotation:
      w: 1.0
      x: 0.0
      y: 0.0
      z: 0.0
    pid_param:
      k: 0.15
      p: 1.0
      i: 0.1
      d: 0.0
      i_limit: 0.3
      out_limit: 1.0
      cycle: false
    gyro_topic_name: bmi088_gyro
    accl_topic_name: bmi088_accl
    target_temperature: 45
    task_stack_depth: 2048
    camera_sync_pin_name: CAMERA
    camera_sync_div: 10
- id: ahrs
  name: MadgwickAHRS
  constructor_args:
    beta: 0.033
    gyro_topic_name: bmi088_gyro
    accl_topic_name: bmi088_accl
    quaternion_topic_name: ahrs_quaternion
    euler_topic_name: ahrs_euler
    task_stack_depth: 2048
- id: buzzer_alarm
  name: BuzzerAlarm
  constructor_args:
    alarm_freq: 5000
    alarm_duty: 300
    alarm_cycle: 300
- id: cmd
  name: CMD
  constructor_args:
    mode: CMD::Mode::CMD_OP_CTRL
    chassis_cmd_topic_name: chassis_cmd
    gimbal_cmd_topic_name: gimbal_cmd
    launcher_cmd_topic_name: launcher_cmd
- id: host_cmd
  name: HostData
  constructor_args:
    cmd: '@cmd'
    host_euler_topic_name: target_eulr
    host_chassis_data_topic_name: chassis_data
    host_fire_topic_name: fire_notify
- id: dr16
  name: DR16
  constructor_args:
    CMD: '@cmd'
    task_stack_depth_uart: 2048
    cmd_data_tp_name: cmd_raw_data_
- id: motor_pit
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: false
      feedback_id: 0x205
      can_bus_name: can2
- id: motor_yaw
  name: RMMotor
  constructor_args:
    param:
      model: RMMotor::Model::MOTOR_GM6020
      reverse: true
      feedback_id: 0x20A
      can_bus_name: can2
- id: gimbal
  name: Gimbal
  constructor_args:
    task_stack_depth: 4096
    param_pid_yaw_speed:
      k: 1.0
      p: 0.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    param_pid_yaw_angle:
      k: 1.0
      p: 5.0
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    param_pid_pitch_speed:
      k: 0.11
      p: 0.1
      i: 0.0
      d: 0.0
      i_limit: 0.0
      out_limit: 0.0
      cycle: false
    param_pid_pitch_angle:
      k: 5.0
      p: 10.0
      i: 5.0
      d: 0.01
      i_limit: 0.0
      out_limit: 0.0
      cycle: true
    motor_pitch: '@&motor_pit'
    motor_yaw: '@&motor_yaw'
    cmd: '@&cmd'
    gimbal_param:
      I_pitch: 0.0
      I_yaw: 0.0
      M_pitch: 0.0
      G_pitch: 0.0
      pitch_min: 0.0
      pitch_max: 0.0
- id: SharedTopic_0
  name: SharedTopic
  constructor_args:
    uart_name: usb_ai
    task_stack_depth: 2048
    buffer_size: 256
    topic_configs:
    - fire_notify
    - target_eulr
    - chassis_data
- id: SharedTopicClient_0
  name: SharedTopicClient
  constructor_args:
    uart_name: usb_ai
    task_stack_depth: 2048
    buffer_size: 256
    topic_configs:
    - ahrs_quaternion
- id: event_bind
  name: EventBinder
  constructor_args:
    modules:
    - name: dr16
      module_ref: '@dr16'
    - name: cmd
      module_ref: '@cmd'
    - name: gimbal
      module_ref: '@gimbal'
    event_binding_groups:
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_MID
        target_module: cmd
        target_event: CMD::Mode::CMD_OP_CTRL
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_BOT
        target_module: cmd
        target_event: CMD::Mode::CMD_AUTO_CTRL
    - bindings:
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_TOP
        target_module: gimbal
        target_event: Gimbal::GimbalEvent::SET_MODE_RELAX
      - source_module: dr16
        source_event: DR16::SwitchPos::DR16_SW_R_POS_MID
        target_module: gimbal
        target_event: Gimbal::GimbalEvent::SET_MODE_RELATIVE
  template_args:
    ChassisType: Omni
